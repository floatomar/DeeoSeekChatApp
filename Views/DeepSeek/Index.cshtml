@{
    ViewBag.Title = "DeepSeek Chat";
}

<div class="container mt-5">
    <h1 class="text-center">DeepSeek Chat</h1>

    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    Chat with DeepSeek AI
                </div>
                <div class="card-body">
                    <div id="chat-container" style="height: 400px; overflow-y: scroll; margin-bottom: 15px; border: 1px solid #ddd; padding: 10px;">
                        <!-- Chat messages will appear here -->
                    </div>

                    <div class="input-group">
                        <input type="text" id="message-input" class="form-control" placeholder="Type your message here...">
                        <div class="input-group-append">
                            <button id="send-button" class="btn btn-primary">Send</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section scripts {
    <script>
        $(document).ready(function() {
            $('#message-input').keypress(function(e) {
                if (e.which === 13) { // Enter key
                    sendMessage();
                }
            });

            $('#send-button').click(sendMessage);

            function sendMessage() {
                var message = $('#message-input').val().trim();
                if (message === '') return;

                // Add user message to chat
                addMessage('You', message, 'user');
                $('#message-input').val('');

                // Show "Thinking..." message
                var thinkingId = 'thinking-' + Date.now();
                addMessage('DeepSeek', 'Thinking...', 'ai', thinkingId);

                // Send to server
                $.post('@Url.Action("Chat", "Home")', { message: message })
                    .done(function(response) {
                        if (response.success) {
                            // Replace "Thinking..." with actual response
                            $('#' + thinkingId).html('<strong>DeepSeek:</strong> ' + response.response);
                        } else {
                            $('#' + thinkingId).html('<strong>Error:</strong> ' + response.error);
                        }
                    })
                    .fail(function() {
                        $('#' + thinkingId).html('<strong>Error:</strong> Failed to get response from server');
                    });
            }

            function addMessage(sender, message, type, id) {
                var messageHtml = '<div id="' + (id || '') + '" class="mb-2"><strong>' + sender + ':</strong> ' + message + '</div>';
                $('#chat-container').append(messageHtml);
                $('#chat-container').scrollTop($('#chat-container')[0].scrollHeight);
            }
        });
    </script>
}